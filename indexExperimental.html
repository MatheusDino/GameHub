<!DOCTYPE html>
<html>
<head>
    <title>Game Hub Manager</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { display: flex; gap: 20px; flex-wrap: wrap; }
        .form-section { border: 1px solid #ddd; padding: 15px; border-radius: 5px; width: 300px; }
        input, select, button { display: block; margin: 10px 0; width: 100%; padding: 8px; }
        button { background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
        .action-group { margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px; }
        .search-container { display: flex; gap: 10px; }
        .search-container input { flex: 1; min-width: 0; } /* Fix for input field */
        .search-container button { width: auto; padding: 8px 15px; } /* Better button sizing */
    </style>
</head>
<body>
    <h1>Game Hub Manager</h1>
    <div class="container">
        <!-- Jogo Section -->
        <div class="form-section">
            <h2>Jogos</h2>
            <input type="text" id="jogoNome" placeholder="Nome do Jogo">
            <input type="text" id="jogoGenero" placeholder="Gênero">
            <input type="text" id="jogoPublisher" placeholder="Publisher">
            <button onclick="createJogo()">Create Jogo</button>
            
            <div class="action-group">
                <h3>Basic Operations</h3>
                <button onclick="getJogos()">Get All Jogos</button>
                <button onclick="getJogoCount()">Get Jogo Count</button>
            </div>
            
            <div class="action-group">
                <h3>Search & Filter</h3>
                <div class="search-container">
                    <input type="text" id="searchNome" placeholder="Search by name">
                    <button onclick="searchJogosByName()">Search</button>
                </div>
                <input type="text" id="filterGenero" placeholder="Filter by genre">
                <button onclick="filterJogosByGenre()">Filter Genre</button>
                <input type="text" id="filterPublisher" placeholder="Filter by publisher">
                <button onclick="filterJogosByPublisher()">Filter Publisher</button>
            </div>
            
            <div class="action-group">
                <h3>Advanced Operations</h3>
                <input type="number" id="jogoId" placeholder="Jogo ID">
                <button onclick="getJogoById()">Get Jogo by ID</button>
                <button onclick="deleteJogo()">Delete Jogo</button>
                <div>
                    <input type="number" id="pageNumber" placeholder="Page" value="0" style="width: 40%;">
                    <input type="number" id="pageSize" placeholder="Size" value="10" style="width: 40%;">
                    <button onclick="getPaginatedJogos()">Get Paginated</button>
                </div>
            </div>
            
            <pre id="jogoResult">Results will appear here</pre>
        </div>

        <!-- Conquista Section -->
        <div class="form-section">
            <h2>Conquistas</h2>
            <input type="text" id="conquistaNome" placeholder="Nome da Conquista">
            <input type="number" id="conquistaProgresso" placeholder="Progresso (0-100)" min="0" max="100">
            <select id="jogoSelect">
                <option value="">Select a Game</option>
            </select>
            <label><input type="checkbox" id="conquistaConcluida"> Concluída?</label>
            <button onclick="createConquista()">Create Conquista</button>
            <button onclick="getConquistas()">Get All Conquistas</button>
            <pre id="conquistaResult">Results will appear here</pre>
        </div>

        <!-- Query Section -->
        <div class="form-section">
            <h2>Query</h2>
            <select id="queryJogoSelect">
                <option value="">Select a Game</option>
            </select>
            <button onclick="getConquistasByJogo()">Get Conquistas for Game</button>
            <pre id="queryResult">Query results will appear here</pre>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api';
        let gamesCache = [];

        // Initialize - Load games on startup
        window.onload = function() {
            loadGamesForSelect();
        };

        // Load games into both dropdowns
        async function loadGamesForSelect() {
            try {
                const response = await fetch(`${API_BASE_URL}/jogos`);
                if (!response.ok) throw new Error('Failed to fetch games');
                
                gamesCache = await response.json();
                console.log('Games data:', gamesCache);
                
                const selectElements = [
                    document.getElementById('jogoSelect'), 
                    document.getElementById('queryJogoSelect')
                ];
                
                selectElements.forEach(select => {
                    while (select.options.length > 1) {
                        select.remove(1);
                    }
                    
                    gamesCache.forEach(game => {
                        const option = document.createElement('option');
                        option.value = game.id;
                        option.textContent = game.nomeJogo;
                        select.appendChild(option);
                    });
                });
            } catch (error) {
                console.error('Failed to load games:', error);
                document.getElementById('jogoResult').textContent = 'Error loading games: ' + error.message;
            }
        }

        // ========== JOGO FUNCTIONS ==========
        
        // Create Jogo
        async function createJogo() {
            const jogo = {
                nomeJogo: document.getElementById('jogoNome').value,
                genero: document.getElementById('jogoGenero').value,
                publisher: document.getElementById('jogoPublisher').value
            };
            
            const result = await makeRequest(`${API_BASE_URL}/jogos`, 'POST', jogo);
            document.getElementById('jogoResult').textContent = JSON.stringify(result, null, 2);
            loadGamesForSelect();
        }

        // Get all Jogos
        async function getJogos() {
            const result = await makeRequest(`${API_BASE_URL}/jogos`, 'GET');
            document.getElementById('jogoResult').textContent = JSON.stringify(result, null, 2);
            gamesCache = result;
        }

        // Get Jogo by ID
        async function getJogoById() {
            const id = document.getElementById('jogoId').value;
            if (!id) return alert("Please enter a Jogo ID");
            
            const result = await makeRequest(`${API_BASE_URL}/jogos/${id}`, 'GET');
            document.getElementById('jogoResult').textContent = JSON.stringify(result, null, 2);
        }

        // Delete Jogo
        async function deleteJogo() {
            const id = document.getElementById('jogoId').value;
            if (!id) return alert("Please enter a Jogo ID");
            
            const result = await makeRequest(`${API_BASE_URL}/jogos/${id}`, 'DELETE');
            document.getElementById('jogoResult').textContent = JSON.stringify(result, null, 2);
            loadGamesForSelect();
        }

        // Search by name
        async function searchJogosByName() {
            const nome = document.getElementById('searchNome').value;
            if (!nome) return alert("Please enter a search term");
            
            const result = await makeRequest(`${API_BASE_URL}/jogos/search?nome=${encodeURIComponent(nome)}`, 'GET');
            document.getElementById('jogoResult').textContent = JSON.stringify(result, null, 2);
        }

        // Filter by genre
        async function filterJogosByGenre() {
            const genero = document.getElementById('filterGenero').value;
            if (!genero) return alert("Please enter a genre");
            
            const result = await makeRequest(`${API_BASE_URL}/jogos/genre/${encodeURIComponent(genero)}`, 'GET');
            document.getElementById('jogoResult').textContent = JSON.stringify(result, null, 2);
        }

        // Filter by publisher
        async function filterJogosByPublisher() {
            const publisher = document.getElementById('filterPublisher').value;
            if (!publisher) return alert("Please enter a publisher");
            
            const result = await makeRequest(`${API_BASE_URL}/jogos/publisher/${encodeURIComponent(publisher)}`, 'GET');
            document.getElementById('jogoResult').textContent = JSON.stringify(result, null, 2);
        }

        // Get count of all jogos
        async function getJogoCount() {
            const result = await makeRequest(`${API_BASE_URL}/jogos/count`, 'GET');
            document.getElementById('jogoResult').textContent = `Total Jogos: ${result}`;
        }

        // Get paginated list of jogos
        async function getPaginatedJogos() {
            const page = document.getElementById('pageNumber').value || 0;
            const size = document.getElementById('pageSize').value || 10;
            
            const result = await makeRequest(`${API_BASE_URL}/jogos/paginated?page=${page}&size=${size}`, 'GET');
            document.getElementById('jogoResult').textContent = JSON.stringify(result, null, 2);
        }

        // ========== CONQUISTA FUNCTIONS ==========
        
        async function createConquista() {
            const select = document.getElementById('jogoSelect');
            const selectedOption = select.options[select.selectedIndex];
            
            if (!select.value) {
                alert("Please select a valid game!");
                return;
            }

            const conquista = {
                nomeConquista: document.getElementById('conquistaNome').value,
                progresso: parseInt(document.getElementById('conquistaProgresso').value),
                concluida: document.getElementById('conquistaConcluida').checked,
                jogoId: Number(select.value)
            };
            
            const result = await makeRequest(`${API_BASE_URL}/conquistas`, 'POST', conquista);
            document.getElementById('conquistaResult').textContent = JSON.stringify(result, null, 2);
        }

        async function getConquistas() {
            const result = await makeRequest(`${API_BASE_URL}/conquistas`, 'GET');
            document.getElementById('conquistaResult').textContent = JSON.stringify(result, null, 2);
        }

        async function getConquistasByJogo() {
            const jogoId = document.getElementById('queryJogoSelect').value;
            if (!jogoId) return;
            
            const result = await makeRequest(`${API_BASE_URL}/jogos/${jogoId}/conquistas`, 'GET');
            document.getElementById('queryResult').textContent = JSON.stringify(result, null, 2);
        }

        // Helper function
        async function makeRequest(url, method, body) {
            const options = {
                method,
                headers: { 'Content-Type': 'application/json' }
            };
            if (body) options.body = JSON.stringify(body);
            
            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('Request failed:', error);
                return { error: error.message };
            }
        }
    </script>
</body>
</html>