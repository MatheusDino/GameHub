<!DOCTYPE html>
<html>
<head>
    <title>Game Hub Manager</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { display: flex; gap: 20px; }
        .form-section { border: 1px solid #ddd; padding: 15px; border-radius: 5px; width: 300px; }
        input, select, button { display: block; margin: 10px 0; width: 100%; padding: 8px; }
        button { background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Game Hub Manager</h1>
    <div class="container">
        <!-- Jogo Section -->
        <div class="form-section">
            <h2>Jogos</h2>
            <input type="text" id="jogoNome" placeholder="Nome do Jogo">
            <input type="text" id="jogoGenero" placeholder="Gênero">
            <input type="text" id="jogoPublisher" placeholder="Publisher">
            <button onclick="createJogo()">Create Jogo</button>
            <button onclick="getJogos()">Get All Jogos</button>
            <pre id="jogoResult">Results will appear here</pre>
        </div>

        <!-- Conquista Section -->
        <div class="form-section">
            <h2>Conquistas</h2>
            <input type="text" id="conquistaNome" placeholder="Nome da Conquista">
            <input type="number" id="conquistaProgresso" placeholder="Progresso (0-100)" min="0" max="100">
            <select id="jogoSelect">
                <option value="">Select a Game</option>
            </select>
            <label><input type="checkbox" id="conquistaConcluida"> Concluída?</label>
            <button onclick="createConquista()">Create Conquista</button>
            <button onclick="getConquistas()">Get All Conquistas</button>
            <pre id="conquistaResult">Results will appear here</pre>
        </div>

        <!-- Query Section -->
        <div class="form-section">
            <h2>Query</h2>
            <select id="queryJogoSelect">
                <option value="">Select a Game</option>
            </select>
            <button onclick="getConquistasByJogo()">Get Conquistas for Game</button>
            <pre id="queryResult">Query results will appear here</pre>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api';
        let gamesCache = [];

        // Initialize - Load games on startup
        window.onload = function() {
            loadGamesForSelect();
        };

        // Load games into both dropdowns
        async function loadGamesForSelect() {
            try {
                const response = await fetch(`${API_BASE_URL}/jogos`);
                if (!response.ok) throw new Error('Failed to fetch games');
                
                gamesCache = await response.json();
                console.log('Fetched games:', gamesCache); // Debug log
                
                const selectElements = [
                    document.getElementById('jogoSelect'), 
                    document.getElementById('queryJogoSelect')
                ];
                
                selectElements.forEach(select => {
                    // Clear existing options except the first one
                    while (select.options.length > 1) {
                        select.remove(1);
                    }
                    
                    // Add new options
                    gamesCache.forEach(game => {
                        const option = document.createElement('option');
                        option.value = game.id; // Adjust based on your actual response field
                        option.textContent = game.nomeJogo || game.NomeJogo; // Handle both cases
                        select.appendChild(option);
                    });
                });
            } catch (error) {
                console.error('Failed to load games:', error);
                document.getElementById('jogoResult').textContent = 'Error loading games: ' + error.message;
            }
        }

        // Jogo Functions
        async function createJogo() {
            const jogo = {
                nomeJogo: document.getElementById('jogoNome').value,
                genero: document.getElementById('jogoGenero').value,
                publisher: document.getElementById('jogoPublisher').value
            };
            
            const result = await makeRequest(`${API_BASE_URL}/jogos`, 'POST', jogo);
            document.getElementById('jogoResult').textContent = JSON.stringify(result, null, 2);
            loadGamesForSelect(); // Refresh game list
        }

        async function getJogos() {
            const result = await makeRequest(`${API_BASE_URL}/jogos`, 'GET');
            document.getElementById('jogoResult').textContent = JSON.stringify(result, null, 2);
            gamesCache = result; // Update cache
        }

        // Conquista Functions
        async function createConquista() {
            const conquista = {
                nomeConquista: document.getElementById('conquistaNome').value,
                progresso: parseInt(document.getElementById('conquistaProgresso').value),
                concluida: document.getElementById('conquistaConcluida').checked, // Fixed typo here
                jogoId: parseInt(document.getElementById('jogoSelect').value)
            };
            
            console.log("Sending:", conquista); 

            const result = await makeRequest(`${API_BASE_URL}/conquistas`, 'POST', conquista);
            document.getElementById('conquistaResult').textContent = JSON.stringify(result, null, 2);
        }

        async function getConquistas() {
            const result = await makeRequest(`${API_BASE_URL}/conquistas`, 'GET');
            document.getElementById('conquistaResult').textContent = JSON.stringify(result, null, 2);
        }

        // Query Function
        async function getConquistasByJogo() {
            const jogoId = document.getElementById('queryJogoSelect').value;
            if (!jogoId) return;
            
            const result = await makeRequest(`${API_BASE_URL}/jogos/${jogoId}/conquistas`, 'GET');
            document.getElementById('queryResult').textContent = JSON.stringify(result, null, 2);
        }

        // Helper function
        async function makeRequest(url, method, body) {
            const options = {
                method,
                headers: { 'Content-Type': 'application/json' }
            };
            if (body) options.body = JSON.stringify(body);
            
            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('Request failed:', error);
                return { error: error.message };
            }
        }
    </script>
</body>
</html>